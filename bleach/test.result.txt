...................F.F........................F.........F.......F..........F...........................F.......................
======================================================================
FAIL: Make sure that applying the filter twice doesn't change anything.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_basics.py", line 147, in test_idempotent
    eq_(linked, bleach.linkify(linked))
AssertionError: u'<span>invalid &amp; </span> &lt; extra <a href="http://link.com" rel="nofollow">http://link.com</a><em></em>' != u'<span>invalid &amp; </span> &lt; extra <a href="http://link.com" rel="nofollownofollow">http://link.com</a><em></em>'

======================================================================
FAIL: bleach.tests.test_basics.test_wildcard_attributes
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_basics.py", line 166, in test_wildcard_attributes
    eq_(clean, bleach.clean(dirty, tags=TAG, attributes=ATTR))
AssertionError: u'both <em id="foo">can</em> have <img id="bar" src="foo">' != u'both <em id="foo">can</em> have <img src="foo" id="bar">'

======================================================================
FAIL: bleach.tests.test_links.test_email_link('email to <a href="james@example.com" rel="nofollow">james@example.com</a>', True, 'email to <a href="james@example.com">james@example.com</a>')
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_links.py", line 85, in _check
    eq_(o, linkify(i, parse_email=p))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 428, in linkify
    return _render(forest)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 434, in _render
    return force_unicode(_serialize(tree))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 445, in _serialize
    return serializer.render(stream)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 298, in render
    return "".join(list(self.serialize(treewalker)))
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 230, in serialize
    yield self.encodeStrict(k)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 164, in encodeStrict
    assert(isinstance(string, text_type))
AssertionError

======================================================================
FAIL: We can set random attributes on links.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_links.py", line 155, in test_set_attrs
    linkify('ex.mp', [set_attr]))
AssertionError: '<a href="http://ex.mp" rev="canonical">ex.mp</a>' != u'<a rev="canonical" href="http://ex.mp">ex.mp</a>'

======================================================================
FAIL: Verify that rel="nofollow" is added to an existing link
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_links.py", line 219, in test_add_rel_nofollow
    linkify('<a href="http://yy.com">http://yy.com</a>'))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 428, in linkify
    return _render(forest)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 434, in _render
    return force_unicode(_serialize(tree))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 445, in _serialize
    return serializer.render(stream)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 298, in render
    return "".join(list(self.serialize(treewalker)))
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 230, in serialize
    yield self.encodeStrict(k)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 164, in encodeStrict
    assert(isinstance(string, text_type))
AssertionError

======================================================================
FAIL: Skip linkification in <pre> tags.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_links.py", line 303, in test_skip_pre
    eq_(nofollowed, linkify(already_linked))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 428, in linkify
    return _render(forest)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 434, in _render
    return force_unicode(_serialize(tree))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 445, in _serialize
    return serializer.render(stream)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 298, in render
    return "".join(list(self.serialize(treewalker)))
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 230, in serialize
    yield self.encodeStrict(k)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 164, in encodeStrict
    assert(isinstance(string, text_type))
AssertionError

======================================================================
FAIL: bleach.tests.test_links.test_elements_inside_links
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/nose/case.py", line 197, in runTest
    self.test(*self.arg)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/tests/test_links.py", line 437, in test_elements_inside_links
    linkify('<a href="#">hello<br></a>'))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 428, in linkify
    return _render(forest)
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 434, in _render
    return force_unicode(_serialize(tree))
  File "/home/marcdm/workspace/tmp/bleach-py3/bleach/bleach/__init__.py", line 445, in _serialize
    return serializer.render(stream)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 298, in render
    return "".join(list(self.serialize(treewalker)))
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 230, in serialize
    yield self.encodeStrict(k)
  File "/home/marcdm/workspace/tmp/bleach-py3/blpy/local/lib/python2.7/site-packages/html5lib/serializer/htmlserializer.py", line 164, in encodeStrict
    assert(isinstance(string, text_type))
AssertionError

----------------------------------------------------------------------
Ran 127 tests in 0.753s

FAILED (failures=7)
